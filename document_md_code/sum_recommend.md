#### 黑马推荐课程体系



![img](D:/002--------------/create6@126.com/99b79e964cc94ad6a231c185d0297687/clipboard.png)

### 推荐系统简介

![1565924915681](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565924915681.png)

![1565924964620](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565924964620.png)







浏览-搜索-推荐-广告

搜索:主动,需要提供关键词

推荐:被动,不需要提供关键词,根据客户喜好推荐,排序,锦上添花,解决信息过载,用户没有明确需求(eg.商场导购)



eg.推荐电影,推荐汽车,推荐房产,推荐股票,推荐贷款产品



#### 推荐系统 V.S. 搜索引擎

|          | 搜索     | 推荐     |
| -------- | -------- | -------- |
| 行为方式 | 主动     | 被动     |
| 意图     | 明确     | 模糊     |
| 个性化   | 弱       | 强       |
| 流量分布 | 马太效应 | 长尾效应 |
| 目标     | 快速满足 | 持续服务 |
| 评估指标 | 简明     | 复杂     |





##### 推荐系统原理

社会化推荐:朋友咨询,让好友推荐

基于内容的推荐:通过文本找出相似的内容

基于流行度推荐,排行榜

基于协同过滤的推荐:找到兴趣小组,找有相似兴趣的用户或小组,看看他们最近的行为(eg.看的电影),物以类聚,人以群分



##### 作用:

高效连接用户和物品,

提高用户停留时间和用户活跃程序,

有效的帮助产品实现其商业价值(会有业绩考核,转化率指标)

应用场景:头条,淘宝,垂直领域领头企业





#### 推荐系统和Web项目的区别

- 通过信息过滤实现目标提升 V.S. 稳定的信息流通系统

- - web项目: 处理复杂业务逻辑，处理高并发，为用户构建一个稳定的信息流通服务
  - 推荐系统: 追求指标增长, 留存率/阅读时间/GMV (Gross Merchandise Volume电商网站成交金额)/视频网站VV (Video View)

- 确定 V.S. 不确定思维

- - web项目: 对结果有确定预期
  - 推荐系统: 结果是概率问题,**不确定性**

概率思想,统计思想





#### 推荐系统要素

- UI 和 UE(前端界面)
- 数据 (Lambda架构)
- 业务知识
- 算法





1EB = 1024 PB

1PB = 1024 TB

1TB = 1024 GB



#### 大数据Lambda架构

- Lambda架构是由实时大数据处理框架Storm的作者Nathan Marz提出的一个实时大数据处理框架。
- Lambda架构的将离线计算和实时计算整合，设计出一个能满足实时大数据系统关键特性的架构，包括有：高容错、低延时和可扩展等。
- 离线计算(计算量大,耗时长,Hadoop,模型训练)

![img](file:///D:/002--------------/create6@126.com/337849462754418c8465b459cedbdd2c/clipboard.png)

#### 分层架构

- 批处理层
  - 数据不可变, 可进行任何计算, 可水平扩展
  - 高延迟 几分钟~几小时(计算量和数据量不同)
  - 日志收集： Flume
  - 分布式存储： Hadoop
  - 分布式计算： Hadoop、Spark
  - 视图存储数据库
    - nosql(HBase/Cassandra)
    - Redis/memcache
    - MySQL
- 实时处理层
  - 流式处理, 持续计算
  - 存储和分析某个窗口期内的数据（一段时间的热销排行，实时热搜等）
  - 实时数据收集 flume & kafka
  - 实时数据分析 spark streaming/storm/flink
- 服务层
  - 支持随机读
  - 需要在非常短的时间内返回结果
  - 读取批处理层和实时处理层结果并对其归并





#### Lambda架构图

![img](file:///D:/002--------------/create6@126.com/41f0587cc7464d3ebc2ab05951241fd4/clipboard.png)





### 推荐算法架构

#### 1,召回阶段 (海选)  recall

召回决定了最终推荐结果的天花板

##### 常用算法

- 协同过滤 cf  (Collaborative Filtering)
- 基于内容 cb (content based)



#### 2.排序阶段 （精选）ranking

- 召回决定了最终推荐结果的天花板, 排序逼近这个极限, 决定了最终的推荐效果

  CTR预估 (点击率预估 使用LR算法) 估计用户是否会点击某个商品 需要用户的点击数据

  逻辑回归 LogisticRegression ,无法根据特征

  0,1,估计用户点击某一个item概率

  根据概率去排序



#### 3.策略调整

- 过滤掉用户看了多次没反应的
- 商业合作,广告置顶,竞价排名
- 加入特征:时间点,价格区间

![img](D:/002--------------/create6@126.com/10c0866c6026487baa008197b3fff1e6/clipboard.png)



##### SPARK（计算引擎）

Apache Spark 是专为大规模数据处理而设计的快速通用的计算引擎。Spark是UC Berkeley AMP lab (加州大学伯克利分校的AMP实验室)所开源的类Hadoop MapReduce的通用并行框架，Spark，拥有Hadoop MapReduce所具有的优点；但不同于MapReduce的是——Job中间输出结果可以保存在内存中，从而不再需要读写HDFS，因此Spark能更好地适用于数据挖掘与机器学习等需要迭代的MapReduce的算法。



Spark 是一种与 Hadoop 相似的开源集群计算环境，但是两者之间还存在一些不同之处，这些有用的不同之处使 Spark 在某些工作负载方面表现得更加优越，换句话说，Spark 启用了内存分布数据集，除了能够提供交互式查询外，它还可以优化迭代工作负载。





#### 推荐模型构建流程

类似机器学习流程

数据处理-->特征工程-->训练算法模型-->评估上线

Data(数据)->Features(特征)->ML Algorithm(选择算法训练模型)->Prediction Output(预测输出)

- 数据清洗/数据处理
  - 数据来源
    - 显性数据
      - Rating 打分
      - Comments 评论/评价
    - 隐形数据
      -  Order history 历史订单
      -  Cart events 加购物车
      -  Page views 页面浏览
      -  Click-thru 点击
      -  Search log 搜索记录
  - 数据量/数据能否满足要求
- 特征工程
  - 从数据中筛选特征
    - 一个给定的商品，可能被拥有类似品味或需求的用户购买
    - 使用用户行为数据描述商品



#### 推荐系统算法



##### 1.基于协同过滤的推荐 CF

![1565925633414](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565925633414.png)

##### 2.基于内容的推荐 CB

![1565925726385](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565925726385.png)

##### 3.基于人口统计学的推荐



##### 4.混合推荐

![1565926065774](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565926065774.png)







### 协同过滤算法 CF

#### 基于近邻的协同过滤

（Collaborative Filtering）

基于用户的协同过滤

基于物品的协同过滤

特征工程 需要把准备好

计算相似度

 - 杰卡德 01
 - 余弦/皮尔逊 连续的评分数据

根据相似度找到最相似的用户/最相似的物品

协同过滤对用户行为数据量要求比较高,数量量大时效果好



##### 算法思想：

基本的协同过滤推荐算法基于以下假设：

- “跟你喜好相似的人喜欢的东西你也很有可能喜欢” ：基于用户的协同过滤推荐（User-based CF）人以群分
- “跟你喜欢的东西相似的东西你也很有可能喜欢 ”：基于物品的协同过滤推荐（Item-based CF）物以类聚

实现协同过滤推荐有以下几个步骤：

1. 找出最相似的人或物品：TOP-N相似的人或物品

通过计算两两的相似度来进行排序，即可找出TOP-N相似的人或物品

1. 根据相似的人或物品产生推荐结果

利用TOP-N结果生成初始推荐结果，然后过滤掉用户已经有过记录的物品或明确表示不感兴趣的物品

以下是一个简单的示例，数据集相当于一个用户对物品的购买记录表：打勾表示用户对物品的有购买记录

- 关于相似度计算这里先用一个简单的思想：如有两个同学X和Y，X同学爱好[足球、篮球、乒乓球]，Y同学爱好[网球、足球、篮球、羽毛球]，可见他们的共同爱好有2个，那么他们的相似度可以用：2/3 * 2/4 = 1/3 ≈ 0.33 来表示。

![img](D:/002--------------/create6@126.com/aae1613debf74fc3b4816f5c6781ec7b/clipboard.png)

 欧氏距离的值是一个非负数, 最大值正无穷, 通常计算相似度的结果希望是[-1,1]或[0,1]之间,一般可以使用

 如下转化公式:

![img](file:///D:/002--------------/create6@126.com/e932e07c42534ea5a25be0b1eddeadba/clipboard.png)

##### 相似度与相似距离

各个相似度对比

余弦相似度与方向相关于距离无关,应对方案:皮尔逊

余弦相似度与皮尔逊相关系数Pearson不适合计算布尔值(01分布,买与不买)向量之间的相关度

01分布用杰卡德相似度



##### 杰卡德相似性度量

（1）杰卡德相似系数

两个集合A和B交集元素的个数在A、B并集中所占的比例，称为这两个集合的杰卡德系数，用符号 J(A,B) 表示。杰卡德相似系数是衡量两个集合相似度的一种指标（余弦距离也可以用来衡量两个集合的相似度）。

![img](D:/002--------------/create6@126.com/84c9713079854ad3a9f6aff05d73ad93/2ea8d10e3d33.gif)

（2）杰卡德距离(不相似的)

与杰卡德相似系数相反的概念是杰卡德距离（Jaccard Distance），可以用如下公式来表示：

![img](D:/002--------------/create6@126.com/b57df45c8f93481690c3b6311b154460/18ab4d4b0e8e.gif)

**杰卡德距离 +  杰卡德相似系数 = 1**



![img](file:///D:/002--------------/create6@126.com/51d3acaf5d13413caa6c2a6487a87f5e/clipboard.png)





pandas中corr方法可直接用于计算皮尔逊相关系数

计算相似度可以进行小**优化**,(对角)减少计算量,eg.九九乘法表的梯度



##### 皮尔逊相关系数Pearson

- 实际上也是余弦相似度, 不过先对向量做了中心化, 向量a b各自减去向量的均值后, 再计算余弦相似度
- 皮尔逊相似度计算结果在-1,1之间 -1表示负相关, 1表示正相关
- 度量两个变量是不是同增同减
- 皮尔逊相关系数度量的是两个变量的变化趋势是否一致, **不适合计算布尔值向量之间的相关度**



![img](D:/002--------------/create6@126.com/31cc963452b74d6e83c19652274f431c/clipboard.png)



##### 余弦距离和欧氏距离的对比

余弦距离使用两个向量夹角的余弦值作为衡量两个个体间差异的大小。相比欧氏距离，余弦距离更加注重两个向量在方向上的差异。

借助三维坐标系来看下欧氏距离和余弦距离的区别：

![img](D:/002--------------/create6@126.com/9d9af94774984a22b8b2e4b69ff8911e/7f1eaf13d0b.jpeg)

从上图可以看出，欧氏距离衡量的是空间各点的绝对距离，跟各个点所在的位置坐标直接相关；而余弦距离衡量的是空间向量的夹角，更加体现在方向上的差异，而不是位置。如果保持A点位置不变，B点朝原方向远离坐标轴原点，那么这个时候余弦距离 

![img](D:/002--------------/create6@126.com/a29537daab864859ae8d863c8697ae2c/acfcda9d2b6e.gif)

 是保持不变的（因为夹角没有发生变化），而A、B两点的距离显然在发生改变，这就是欧氏距离和余弦距离之间的不同之处。

欧氏距离和余弦距离各自有不同的计算方式和衡量特征，因此它们适用于不同的数据分析模型：

欧氏距离能够体现个体数值特征的绝对差异，所以更多的用于需要从维度的数值大小中体现差异的分析，如使用用户行为指标分析用户价值的相似度或差异。

余弦距离更多的是从方向上区分差异，而对绝对的数值不敏感，更多的用于使用用户对内容评分来区分兴趣的相似度和差异，同时修正了用户间可能存在的度量标准不统一的问题（因为余弦距离对绝对数值不敏感）。

 



预测用户对物品的评分 （以用户1对电影1评分为例）
$$
评分公式  pred(u,i)=r^ui=∑v∈Usim(u,v)∗rvi∑v∈U|sim(u,v)|
$$




![img](file:///D:/002--------------/create6@126.com/909b6647161a4f958a13365a263b6cc9/clipboard.png)







##### User_CF和Item_CF比较

![img](D:/002--------------/create6@126.com/fdc6b896ead6443ebaf24be94cc592d9/clipboard.png)



![img](D:/002--------------/create6@126.com/50b9f831c7fe4f69ab0d796363a226c2/clipboard.png)

##### 协同过滤推荐优缺点

![img](D:/002--------------/create6@126.com/bb040e515d684eb7b27fc36eaaf8764d/clipboard.png)





##### 协同过滤VS隐语义

![1565938142157](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565938142157.png)



#### 推荐评估

准确性

- rmse,mae精准率,召回率
- 业务指标是否提升

![1565939489116](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565939489116.png)

![1565938308906](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565938308906.png)

![1565938403749](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565938403749.png)

覆盖率与熵



##### 在线评估

灰度发布(低比例测试,慢慢调高比例)

A/B测试(对照组)



随机推荐,热门推荐

指标与业绩平衡





#### 推荐系统的冷启动问题

##### 用户冷启动(新用户)

![img](D:/002--------------/create6@126.com/d45b3e83424744c0ac891db59353caeb/clipboard.png)



方案:

1. 尽可能收集各种用户的信息,给用户打各种标签
2. 通过标签做用户的聚类,通过user_cf推荐
3. 可以考虑使用热门推荐



手机电量状况与心理状态

热门推荐与随机推荐



##### 物品冷启动

![img](D:/002--------------/create6@126.com/3dd118a42c764862a6da742568d63a76/clipboard.png)

利用标签找到相似的物品,相似的物品可能有消费记录

基于内容的推荐





应用方向:

![img](D:/002--------------/create6@126.com/10323469c18b49f5a56229646928fbe6/clipboard.png)

eg.推荐电影,推荐汽车,推荐房产,推荐股票,推荐贷款产品



##### 系统冷启动(新用户 +　新物品）



- 基于内容的推荐 系统早期
- 基于内容的推荐逐渐过渡到协同过滤
- 基于内容的推荐和协同过滤的推荐结果都计算出来 加权求和得到最终推荐结果



#### 基于模型的协同过滤

Model-Based CF算法

- 基于分类算法、回归算法、聚类算法
- 基于矩阵分解的推荐
- 基于神经网络算法
- 基于图模型算法



- 奇异值分解（SVD）
- 潜在语义分析（LSA）
- 支撑向量机（SVM)



##### 1-基于回归模型的协同过滤推荐







##### 2-基于矩阵分解的协同过滤推荐











### 基于内容的推荐算法 CB

（Content-Based）

![1565925726385](C:\Users\struggle6\AppData\Roaming\Typora\typora-user-images\1565925726385.png)

#### 简介

基于内容的推荐方法是非常直接的，它以物品的内容描述信息为依据来做出的推荐，本质上是基于对物品和用户自身的特征或属性的直接分析和计算。

例如，假设已知电影A是一部喜剧，而恰巧我们得知某个用户喜欢看喜剧电影，那么我们基于这样的已知信息，就可以将电影A推荐给该用户。



##### 基于内容的推荐实现步骤

- **画像构建**。顾名思义，画像就是刻画物品或用户的特征。本质上就是给用户或物品贴标签。
  - **物品画像**：例如给电影《战狼2》贴标签，可以有哪些？



##### 基于内容推荐的算法流程：

- 根据PGC/UGC内容构建物品画像
- 根据用户行为记录生成用户画像
- 根据用户画像从物品中寻找最匹配的TOP-N物品进行推荐

##### 物品冷启动处理：

- 根据PGC内容构建物品画像
- 利用物品画像计算物品间两两相似情况
- 为每个物品产生TOP-N最相似的物品进行相关推荐：如与该商品相似的商品有哪些？与该文章相似文章有哪些？









